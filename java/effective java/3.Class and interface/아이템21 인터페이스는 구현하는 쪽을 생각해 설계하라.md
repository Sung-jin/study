## 인터페이스는 구현하는 쪽을 생각해 설계하라

* Java 8 이전에는 기존 구현체를 깨뜨리지 않고 인터페이스에 메서드를 추가할 방법이 없었다
* 기존 인터페이스에 디폴트 메서드를 추가하면, 기존 구현 클래스는 해당 메서드가 자신도 모르게 추가가 되는 현상이 발생한다
* 핵심 컬렉션 인터페이스들에 다수의 디폴트 메서드들이 추가되었다
    * 주로 람다를 활용하기 위해서 추가되었다
* 디폴트 메서드는 코드 품질이 높고 범용적이라 대부분의 상황에서 잘 동작한다
    * 하지만 불변식을 해치지 않는 디폴트 메서드를 작성하기는 어렵다
    * 컬렉션의 `removeIf` 와 같은 디폴트 메서드는 아파치 커먼즈 라이브러리의 SynchronizedCollection 에서 문제가 된 시점이 있다
        * 클라이언트가 제공한 객체로 락을 거는 능력을 추가로 제공하였다
        * 이는 모든 메서드에서 주어진 락 객체로 동기화한 후 내부 컬렉션 객체에 기능을 위임하는 래퍼 클래스이다
        * removeIf 를 재정의 하지 않고 있으므로, 디폴트 메서드 구현을 그대로 사용하게 되고, 이는 동기화에 관련해 보장해줄 수 없게 된다
    * 자바 플랫폼 라이브러리에서는 이러한 문제를 예방하기 위해 일련의 조치를 취했으나, 자바 플랫폼에 속하지 않은 라이브러리들은 수정되지 못하고 나중에 수정되거나 아직도 방치된 것들이 존재한다
* 디폴트 메서드는 컴파일에 성공하더라도 기존 구현체에 런타임 오류를 일으킬 수 있다
* 따라서 기존 인터페이스에 디폴트 메서드로 새 메서드를 추가하는 일은 꼭 필요한 경우가 아니라면 피해야만 한다
    * 디폴트 메서드를 추가함으로써 기존 구현체들과 충돌하지 않는지 확인이 필요하다
* 반대로 새로운 인터페이스를 만든다면, 디폴트 메서드는 표준적인 메서드 구현을 제공한다는 점에서 아주 유용한 수단이다
* 디폴트 메서드는 인터페이스로부터 메서드를 제거하거나 기존 메서드의 시그니처를 수정하는 용도가 아님을 명심해야 한다
    * 이렇게 사용하면, 기존에 구현된 클라이언트를 망가뜨리게 된다

## 정리

* 디폴트 메서드라는 도구가 생겼더라도 인터페이스를 설계할 때는 여전히 세심한 주의가 필요하다
* 디폴트 메서드로 기존 인터페이스에 새로운 메서드를 추가하면 커다란 위험도 온다는 것을 알아야 한다
* 새로운 인터페이스라면 릴리즈 전에 반드시 테스트를 거쳐야 한다
    * 해당 인터페이스로 서로 다른 방식으로 최소한 세가지 이상 구현해봐야 한다
    * 인터페이스의 인스턴스를 다양한 작업에 활용하는 클라이언트도 여러개 만들어서 테스트 해야 한다
* 인터페이스를 릴리즈한 후에도 결함을 수정할 수 있으나, 그러한 가능성을 절대로 기대서는 안된다

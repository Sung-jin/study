### Json Web Token

* 전자 서명 된 URL-safe 의 JSON
    * 전자 서명을 통해 JSON 의 변조를 체크할 수 있다
* JWT 는 속성 정보를 JSON 데이터 구조로 표현한 토큰이며, RFC7519 표준이다
* JWT 는 서버와 클라이언트 간 정보를 주고 받을 때 http 헤더에 JSON 토큰을 넣은 후 서버는 별도의 인증 과정없이 헤더에 포함되어 있는 JWT 정보를 통해 인증한다
    * JSON 데이터는 URL-safe 하도록 URL 에 포함할 수 있는 문자만 사용한다
* JWT 는 HMAC 알고리즘을 사용하여 비밀키 또는 RSA 를 이용한 Pub/Private Key 쌍으로 서명할 수 있다

#### Json Web Signature, Json Web Encryption

* JWS 는 JSON 데이터 구조를 사용하는 서명 표준으로 RFC7515 이다
    * JSON 으로 전자 서명하여 URL-safe 문자열로 표현
    * 해당 서명을 활용하여 JSON 이 손상 여부를 확인할 수 있다
* JWE 는 JSON 데이터 구조를 사용하는 암호화 방법으로 RFC7516 이다
    * JSON 을 암호화하여 URL-safe 문자로 표현
    
#### JWT 토큰 구성

> aaaaaaaaa.bbbbbbbbb.ccccccccc
> header    payload   signature

* Header
    * 토큰의 타입과 해시 암호화 알고리즘으로 구성되어 있다
        1. 토큰의 유형 (JWT)
        1. HMAC, SHA256, RSA 와 같은 해시 알고리즘
* Payload
    * 토큰에 담을 claim 정보를 포함하며, claim 은 payload 에 담는 정보의 한조각이라 한다
    * claim 은 name / value 의 한 쌍으로 이루어져 있다
    * 토큰에 여러개의 claim 을 넣을 수 있다
    * claim 의 정보는 등록된 claim, 공개 claim, 비공개 claim 과 같은 총 3 종류가 있다
* signature
    * secret key 를 포함하여 암호화 되어 있다
    
#### JWT process

* 기존의 토큰 방식
    1. 기존의 토큰 인증 방식은 모든 서비스 호출에 사용된다
    1. 서비스를 받기 위해서는 토큰의 유효성을 확인하여 세부 정보를 쿼리하며, 참조에 의한 호출 형태로 모든 서비스는 항상 상호 작용할 때 다시 접속한다
* JWT 의 경우 갑셍 의한 호출이 가능한 토큰이며, 토큰이 필요한 모든 정보를 가지고 있다
    * 모든 정보를 가지고 있기 때문에 참조가 필요없으며, 마이크로서비스 자체에 유효성을 검증한다
* JWT 동작
    1. 사용자가 id, pw 를 입력하여 로그인 시도
    1. 서버는 요청을 확인 후 secret key 를 통해 access token 을 발급하여 client 에 전달
    1. client 에서 API 를 요청할 때 **Authorization header 에 access token** 을 담아서 전달
    1. 서버에서 해당 access token 을 체크 후 payload 로부터 사용자 정보를 확인해서 데이터를 반환
    1. client 의 로그인 정보를 서버에 메모리에 저장하지 않기 떄문에 토큰기반 인증 메커니즘을 제공

#### JWT 특징

* JWT 에는 필요한 모든 정보를 토큰에 포함하기 때문에 데이터베이스와 같은 서버와의 커뮤니케이션 오버 헤드를 최소화 할 수 있다
* CORS 는 쿠키를 사용하지 않기 때문에, JWT 를 채용 한 인증 메커니즘은 두 도메인에서 API 를 제공하더라도 문제가 발생하지 않는다
* 처음 사용자를 등록할 때 Access token 과 Refresh token 이 모두 발급되어야 한다

#### JWT 장점

* 사용자 인증에 필요한 모든 정보는 토큰 자체에 포함하기 때문에 별도의 인증 저장소가 필요 없다
* 분산 마이크로 서비스 환경에서 중앙 집중식 인증 서버와 데이터베이스에 의조하지 않는 인증 및 인가 방법을 제공
* 토큰의 유효성 검사 시점에 CPU 사이클을 필요로 하고, IO/네트워크 액세스가 필요하지 않으며, 최신 웹 서버 하드웨어에서 확장하기 쉽다
* JSON 웹 토큰의 사용을 권장하는 이유
    1. URL 파라미터와 헤더로 사용
    1. 수평 스케일이 용이
    1. 디버깅 및 관리가 용이 
    1. 트래픽에 대한 부담이 적음 
    1. REST 서비스로 제공 가능
    1. 내장된 만료 
    1. 독립적인 JWT

#### JWT 단점

* 토큰은 클라이언트에 저장되어 데이터베이스에 사용자 정보를 조작하더라도 토큰에 직접 적용할 수 없다
* 필드가 추가되면 토큰이 커진다
* 비상태 애플리케이션에서 토큰은 거의 모든 요청에 대해 전송되므로 데이터 트래픽 크기에 영향을 미칠 수 있다

